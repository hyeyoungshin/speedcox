
---
12:27:43 Mountain

# accelerometer implementation

1. New Variables:

```javascript
let motionPermission = false;   // Do we have permission to use motion sensors?
let accelerationHistory = [];   // Array storing recent acceleration data
let lastStrokeDetection = 0;    // When did we last detect a stroke?
let currentStrokeRate = 0;      // Current calculated stroke rate
```


2. Initialization Functions:

- `initializeSensors()` - Sets up both GPS and motion
- `requestMotionPermission()` - Handles iOS/Android permission differences
- `setupMotionListeners()` - Adds the motion event listener
- `handleDeviceMotion()` - THE MAIN ACCELEROMETER FUNCTION
- `detectStroke()` - THE STROKE DETECTION ALGORITHM


3. Motion Processing Logic:
```javascript
// This function runs every time your phone moves!
function handleDeviceMotion(event) {
    // Gets X, Y, Z acceleration data
    const acceleration = event.accelerationIncludingGravity;
    
    // Calculates total movement magnitude
    const magnitude = Math.sqrt(
        Math.pow(acceleration.x || 0, 2) +  // Side to side
        Math.pow(acceleration.y || 0, 2) +  // Forward/back  
        Math.pow(acceleration.z || 0, 2)    // Up/down
    );
    
    // Stores the data and tries to detect strokes
    detectStroke(magnitude, timestamp);
}
```


4.  Updated Detection Function:

Now `simulateStrokeDetection()` checks for real data first, only simulating if sensors aren't working.


5. New UI Element:

Added "Enable Motion Sensors" button in settings for iOS users.


### How It Actually Works:

1. Page loads → `initializeSensors()` runs
2. Requests permission → iOS shows popup, Android auto-grants
3. Sets up listener → `window.addEventListener('devicemotion', handleDeviceMotion)`
4. Phone moves → `handleDeviceMotion()` processes acceleration data
5. Detects patterns → `detectStroke()` finds rowing-like movements
6. Updates display → Real stroke rate shown instead of simulation

The implementation is fully functional - it will detect real rowing strokes when you move your phone in a rowing motion!

---
